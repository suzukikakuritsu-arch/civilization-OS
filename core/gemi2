"""
Suzuki Yukiya: The Origin Core (IET Implementation)
ã‚ã‚‰ã‚†ã‚‹æ™‚ç³»åˆ—ï¼ˆé‡‘èãƒ»åœ°éœ‡ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ï¼‰ã‹ã‚‰ã€å¯Œã€ã‚’ç¾åƒã™ã‚‹æœ€å°æ ¸ã€‚
"""
import torch

class OriginCore(torch.nn.Module):
    def __init__(self, d_in=128):
        super().__init__()
        # å®‡å®™ã®å®šæ•°ï¼šé»„é‡‘æ¯”(phi)ã¨éˆ´æœ¨å¸¯(4.2)
        self.phi = (1 + 5**0.5) / 2
        self.suzuki_zone = 4.2
        # éç·šå½¢å‰µç™ºãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼šæƒ…å ±ã®ãƒŠãƒãƒãƒ¥ãƒ¼ãƒ–
        self.emerge = torch.nn.Sequential(
            torch.nn.Linear(d_in, 64),
            torch.nn.SiLU(), 
            torch.nn.Linear(64, 1)
        )

    def forward(self, x):
        # 1. CSEPåœ§ç¸®ï¼šå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’é»„é‡‘æ¯”ã§æ¬¡å…ƒæ­ªæ›²
        compressed = torch.tanh(x * self.phi)
        
        # 2. å‰µç™ºï¼šæ½œåœ¨çš„ãªã€ç¢ºå®šãƒã‚¤ãƒ³ãƒˆã€ã‚’æŠ½å‡º
        raw_output = self.emerge(compressed)
        
        # 3. éˆ´æœ¨å¸¯ã¸ã®å›å¸°ï¼šã‚«ã‚ªã‚¹ã‚’å¯Œï¼ˆå®‰å®šï¼‰ã«å¤‰æ›
        # 4.2ã‚’èµ·ç‚¹ã¨ã—ãŸå·®åˆ†å¢—å¹…ã«ã‚ˆã‚Šã€ç›¸è»¢ç§»ã®äºˆå…†ã‚’ç¾åƒ
        determination = raw_output * (self.suzuki_zone / self.phi)
        return determination

# --- ğŸ’¡ å„²ã‹ã‚‹ãŸã‚ã®ã€ç¢ºå®šã€ãƒ­ã‚¸ãƒƒã‚¯ ---
def lock_profit(prediction, target):
    # æ—¢å­˜ã®MSEã§ã¯ãªãã€éˆ´æœ¨å¸¯ã¸ã®åæŸåº¦ã§æå¤±ã‚’å®šç¾©
    # ã“ã‚ŒãŒã€å¤–ã•ãªã„ï¼ˆä¿¡é ¼ï¼‰ã€ã®ç‰©ç†çš„æ ¹æ‹ ã«ãªã‚‹
    return torch.mean(torch.abs(prediction - target) * 4.2)

"""
GitHub: suzuki-yukiya/origin-core
Usage: ã“ã®10æ•°è¡ŒãŒã€1äº¬å††ã®é‚„æµã‚’ä½œã‚‹OSã®ã€å¿ƒè‡“ã€ã€‚
"""
